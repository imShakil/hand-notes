<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Mobarak Hosen Shakil" /><link rel="canonical" href="https://imshakil.github.io/hand-notes/database/sqlite3/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Python SQLite Cheat-Sheet - Shakil's Hand Notes</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Python SQLite Cheat-Sheet";
        var mkdocs_page_input_path = "database/sqlite3.md";
        var mkdocs_page_url = "/hand-notes/database/sqlite3/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Shakil's Hand Notes
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Welcome to MkDocs</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Apache</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../apache/httpd-on-centos/">Httpd on centos</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Bash</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../bash/">Index</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Database</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Python SQLite Cheat-Sheet</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#import-sqlite-module">Import SQLite Module</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#connect-and-create-database">Connect and Create Database</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#creating-create-and-deleting-drop-tables">Creating (CREATE) and Deleting (DROP) Tables</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#inserting-insert-data-into-the-database">Inserting (INSERT) Data into the Database</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#get-last-row-id">Get Last Row ID</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#retrieving-data-select-from-database">Retrieving Data (SELECT) from Database</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#updating-update-and-deleting-delete-data">Updating (UPDATE) and Deleting (DELETE) Data</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#using-sqlite-transactions">Using SQLite Transactions</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sqlite-database-exceptions">SQLite Database Exceptions</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#check-integrity-error">Check Integrity Error</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sqlite-row-factory-and-data-types">SQLite Row Factory and Data Types</a>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Devops</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../devops/docker/">Docker</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../devops/kubernetes/">Kubernetes</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Linux</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../linux/linux-command/">Linux command</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../linux/memory/">To Find All the Process ID</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../linux/top/">Top</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Mysql</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../mysql/basic/">Basic</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Networking</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../networking/ip-config/">Ip config</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Opendj</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../opendj/Connect-internal-LDAP-server-in-LDAP-browser/">Connect internal LDAP server in LDAP browser</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../opendj/basic-config/">Basic config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../opendj/dsconfig/">get-global-configuration-prop</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../opendj/export-import/">Export data</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../opendj/ldapsearch/">To count total users in opendj backends:</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Os</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../os/linux/">Linux</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Ssh</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../ssh/host-manage/">Host manage</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../ssh/port-forwarding/">Port forwarding</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Tools</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../tools/markdown/">Dropdown in markdown</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tools/ngnix/">Ngnix</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Shakil's Hand Notes</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
          <li>Database &raquo;</li>
      <li class="breadcrumb-item active">Python SQLite Cheat-Sheet</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="python-sqlite-cheat-sheet">Python SQLite Cheat-Sheet</h1>
<p><a href="https://github.com/imshakil/python-sqlite-practice/stargazers"><img alt="GitHub stars" src="https://img.shields.io/github/stars/imshakil/python-sqlite-practice" /></a>
<a href="https://github.com/imshakil/python-sqlite-practice/network"><img alt="GitHub forks" src="https://img.shields.io/github/forks/imshakil/python-sqlite-practice" /></a>
<a href="https://github.com/imshakil/python-sqlite-practice/issues"><img alt="GitHub issues" src="https://img.shields.io/github/issues/imshakil/python-sqlite-practice" /></a>
<a href="https://github.com/imshakil/python-sqlite-practice"><img alt="GitHub license" src="https://img.shields.io/github/license/imshakil/python-sqlite-practice" /></a>
<a href="https://imshakil.github.io/python-sqlite-practice/"><img alt="Hits" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fgithub.com%2Fimshakil%2Fpython-sqlite-practice" /></a>
<a href="https://twitter.com/intent/tweet?text=Wow:&amp;url=https%3A%2F%2Fgithub.com%2Fimshakil%2Fpython-sqlite-practice"><img alt="Twitter" src="https://img.shields.io/twitter/url?style=social&amp;url=https%3A%2F%2Fgithub.com%2Fimshakil%2Fpython-sqlite-practice" /></a></p>
<p>SQLite3 is a very easy to use database engine. It is self-contained, serverless, zero-configuration and transactional.
It is very fast and lightweight, and the entire database is stored in a single disk file. It is used in a lot of
applications as internal data storage. The Python Standard Library includes a module called "sqlite3" intended for
working with this database. This module is a SQL interface compliant with the DB-API 2.0 specification.</p>
<p><strong>Table of Contents</strong>
- <a href="#python-sqlite-cheat-sheet">Python SQLite Cheat-Sheet</a>
  - <a href="#import-sqlite-module">Import SQLite Module</a>
  - <a href="#connect-and-create-database">Connect and Create Database</a>
  - <a href="#creating-create-and-deleting-drop-tables">Creating (<code>CREATE</code>) and Deleting (<code>DROP</code>) Tables</a>
  - <a href="#inserting-insert-data-into-the-database">Inserting (<code>INSERT</code>) Data into the Database</a>
    - <a href="#get-last-row-id">Get Last Row ID</a>
  - <a href="#retrieving-data-select-from-database">Retrieving Data (<code>SELECT</code>) from Database</a>
  - <a href="#updating-update-and-deleting-delete-data">Updating (<code>UPDATE</code>) and Deleting (<code>DELETE</code>) Data</a>
  - <a href="#using-sqlite-transactions">Using SQLite Transactions</a>
  - <a href="#sqlite-database-exceptions">SQLite Database Exceptions</a>
    - <a href="#check-integrity-error">Check Integrity Error</a>
  - <a href="#sqlite-row-factory-and-data-types">SQLite Row Factory and Data Types</a></p>
<h2 id="import-sqlite-module">Import SQLite Module</h2>
<pre><code class="language-python">import random
import sqlite3
</code></pre>
<h2 id="connect-and-create-database">Connect and Create Database</h2>
<p>We use the function <code>sqlite3.connect</code> to connect to the database. We can use the argument <code>:memory:</code> to create 
a temporary DB in the RAM or pass the name of a file to open or create it.</p>
<pre><code class="language-python"># create database in memory
# db = sqlite3.connect(':memory:')

# create database into directory
db = sqlite3.connect(&quot;./data/test.db&quot;)

# get a cursor object
cursor = db.cursor()
</code></pre>
<h2 id="creating-create-and-deleting-drop-tables">Creating (<code>CREATE</code>) and Deleting (<code>DROP</code>) Tables</h2>
<p>In order to make any operation with the database we need to get a cursor object and pass the SQL statements to the 
cursor object to execute them. Finally it is necessary to commit the changes. We are going to create a users table with 
name, phone, email and password columns.</p>
<pre><code class="language-python"># DROP TABLE
cursor.execute(&quot;&quot;&quot;DROP TABLE IF EXISTS users&quot;&quot;&quot;)

# CREATE TABLE
cursor.execute(
    &quot;&quot;&quot;CREATE TABLE IF NOT EXISTS users(
                    id INTEGER PRIMARY KEY,
                    name TEXT,
                    phone TEXT,
                    email TEXT unique,
                    password TEXT
            )&quot;&quot;&quot;
)

db.commit()
</code></pre>
<h2 id="inserting-insert-data-into-the-database">Inserting (<code>INSERT</code>) Data into the Database</h2>
<p>To insert data we use the cursor to execute the query. If you need values from Python variables it is recommended 
to use the "?" placeholder. Never use string operations or concatenation to make your queries because is very insecure.
In this example we are going to insert two users in the database, their information is stored in python variables.</p>
<pre><code class="language-python">name = 'Halim'
phone = &quot;01234567890&quot;
email = &quot;halim@email.com&quot;
password = &quot;ha1234&quot;
cursor.execute(
    &quot;&quot;&quot;INSERT INTO users(name, phone, email, password) VALUES (?,?,?,?)&quot;&quot;&quot;,
    (name, phone, email, password),
)
db.commit()
</code></pre>
<p>The values of the Python variables are passed inside a tuple. 
Another way to do this is passing a dictionary using the <code>:key name</code> placeholder:</p>
<pre><code class="language-python">name = &quot;Alim&quot;
phone = &quot;01234567890&quot;
email = &quot;alim@email.com&quot;
password = &quot;al1234&quot;
cursor.execute(
    &quot;&quot;&quot;INSERT INTO users(name, phone, email, password) VALUES (:name, :phone, :email, :password)&quot;&quot;&quot;,
    {
        &quot;name&quot;: name,
        &quot;phone&quot;: phone,
        &quot;email&quot;: email,
        &quot;password&quot;: password,
    },
)
db.commit()

# use list of users for inserting multiple user info
users = [
    (
        &quot;Name &quot; + str(i),
        str(random.randint(10000000, 1000000000)),
        &quot;name&quot; + str(i) + &quot;@email.com&quot;,
        str(random.randint(10000, 90000)),
    )
    for i in range(10)
]

cursor.executemany(
    &quot;&quot;&quot;INSERT INTO users(name, phone, email, password) VALUES (?, ?, ?, ?)&quot;&quot;&quot;, users
)
db.commit()
</code></pre>
<h3 id="get-last-row-id">Get Last Row ID</h3>
<p>If you need to get the id of the row you just inserted use <code>lastrowid</code></p>
<pre><code class="language-python">print(f&quot;last row id: {cursor.lastrowid}&quot;)
</code></pre>
<h2 id="retrieving-data-select-from-database">Retrieving Data (<code>SELECT</code>) from Database</h2>
<p>To retrieve data, execute the query against the cursor object and then use <code>fetchone()</code> to retrieve a single row or 
<code>fetchall()</code> to retrieve all the rows and <code>fetchmany()</code> to retrieve a particular number or rows.
(note: retrieve rows fetched as a list where each row as a tuple)</p>
<pre><code class="language-python">cursor.execute(&quot;&quot;&quot;SELECT name, phone, email FROM users&quot;&quot;&quot;)
user1 = cursor.fetchone()
print(user1)

user_many = cursor.fetchmany(5)
print(user_many)

user_all = cursor.fetchall()
print(user_all)
</code></pre>
<p>The cursor object works as an iterator, invoking <code>fetchall()</code> automatically</p>
<pre><code class="language-python">cursor.execute(&quot;&quot;&quot;SELECT name, email, phone FROM users&quot;&quot;&quot;)
for row in cursor:
    print(f&quot;name: {row[0]} email: {row[1]} phone: {row[2]}&quot;)
</code></pre>
<p>To retrieve data with conditions, use again the "?" placeholder</p>
<pre><code class="language-python">user_id = 5
cursor.execute(&quot;&quot;&quot;SELECT name, email, phone FROM users WHERE id=?&quot;&quot;&quot;, (user_id,))
print(cursor.fetchone())
</code></pre>
<h2 id="updating-update-and-deleting-delete-data">Updating (<code>UPDATE</code>) and Deleting (<code>DELETE</code>) Data</h2>
<p>The procedure to update or delete data is the same as inserting data</p>
<pre><code class="language-python"># update user phone with id = 5
cursor.execute(&quot;&quot;&quot;UPDATE users SET phone = ? WHERE id = ?&quot;&quot;&quot;, (&quot;01710567890&quot;, user_id))
db.commit()

# delete user row with id = 8
cursor.execute(&quot;&quot;&quot;DELETE FROM users WHERE id = ?&quot;&quot;&quot;, (8,))
db.commit()
</code></pre>
<h2 id="using-sqlite-transactions">Using SQLite Transactions</h2>
<p>Transactions are an useful property of the database systems. It ensures the atomicity of the Database. Use <code>commit()</code> 
method to save the changes and <code>rollback()</code> method to roll back any change to the database since the last call to commit.</p>
<pre><code class="language-python"># update user phone with id = 5
cursor.execute(&quot;&quot;&quot;UPDATE users SET phone = ? WHERE id = ?&quot;&quot;&quot;, (&quot;01712567890&quot;, user_id))
db.rollback()
</code></pre>
<p>Please remember to always call commit to save the changes. If you close the connection using close or the connection to 
the file is lost (maybe the program finishes unexpectedly), not committed changes will be lost.</p>
<h2 id="sqlite-database-exceptions">SQLite Database Exceptions</h2>
<p>For best practices always surround the database operations with a try clause or a context manager.</p>
<pre><code class="language-python">try:
    # create or connect database
    db = sqlite3.connect(&quot;./data/test.db&quot;)

    # get a cursor object
    cursor = db.cursor()

    # check if a table 'users' does exist or not and create it
    cursor.execute(
        &quot;&quot;&quot;CREATE TABLE IF NOT EXISTS users(id INTEGER PRIMARY KEY, name TEXT, phone TEXT, email TEXT unique, password TEXT)&quot;&quot;&quot;
    )
    # commit to save the changes
    db.commit()

except Exception as e:
    # rollback any change if something goes wrong
    db.rollback()
    raise e
finally:
    db.close()
</code></pre>
<h3 id="check-integrity-error">Check Integrity Error</h3>
<p>We can use the Connection object as context manager to automatically commit or rollback transactions</p>
<pre><code class="language-python">name1 = &quot;Mobarak&quot;
phone1 = &quot;3366858&quot;
email1 = &quot;imshakil@github.com&quot;
# A very secure password
password1 = &quot;12345&quot;
try:
    db = sqlite3.connect(&quot;./data/test.db&quot;)
    with db:
        db.execute(
            &quot;&quot;&quot;INSERT INTO users (name, phone, email, password) VALUES (?, ?, ?, ?)&quot;&quot;&quot;,
            (name1, phone1, email1, password1),
        )
except sqlite3.IntegrityError:
    print(&quot;Data already exists&quot;)
finally:
    db.close()
</code></pre>
<p>In the example above if the insert statement raises an exception, the transaction will be rolled back and the message 
gets printed; otherwise the transaction will be committed. Please note that we call execute on the db object, not the 
cursor object.</p>
<h2 id="sqlite-row-factory-and-data-types">SQLite Row Factory and Data Types</h2>
<p>The following table shows the relation between SQLite datatypes and Python datatypes:</p>
<ul>
<li>None type is converted to NULL</li>
<li>int type is converted to INTEGER</li>
<li>float type is converted to REAL</li>
<li>str type is converted to TEXT</li>
<li>bytes type is converted to BLOB</li>
</ul>
<p>The row factory class <code>sqlite3.Row</code> is used to access the columns of a query by name instead of by index.</p>
<pre><code class="language-python">db = sqlite3.connect(&quot;./data/test.db&quot;)
db.row_factory = sqlite3.Row
cursor = db.cursor()
cursor.execute(&quot;&quot;&quot;SELECT name, email, phone FROM users&quot;&quot;&quot;)
for row in cursor:
    print(f&quot;name : {row[0]}, email: {row[1]}, phone: {row[2]}&quot;)

# close database connection
db.close()
</code></pre>
<blockquote>
<p>Thanks to Andres Torres for awesome blog post <br> 
Source: https://www.pythoncentral.io/introduction-to-sqlite-in-python/</p>
</blockquote>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../bash/" class="btn btn-neutral float-left" title="Index"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../devops/docker/" class="btn btn-neutral float-right" title="Docker">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>Copyright &copy 2023; Written & Published by <a href="https://github.com/imshakil">imShakil</a></p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../../bash/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../devops/docker/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
